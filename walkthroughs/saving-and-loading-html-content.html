
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>存取 HTML 内容 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../general/faq.html" />
    
    
    <link rel="prev" href="saving-to-a-database.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    介绍
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">实战</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="installing-slate.html">
            
                <a href="installing-slate.html">
            
                    
                    安装 Slate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="adding-event-handlers.html">
            
                <a href="adding-event-handlers.html">
            
                    
                    添加事件回调
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="defining-custom-block-nodes.html">
            
                <a href="defining-custom-block-nodes.html">
            
                    
                    定制 Block 节点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="applying-custom-formatting.html">
            
                <a href="applying-custom-formatting.html">
            
                    
                    应用自定义格式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="using-plugins.html">
            
                <a href="using-plugins.html">
            
                    
                    使用插件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="saving-to-a-database.html">
            
                <a href="saving-to-a-database.html">
            
                    
                    保存到数据库
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.7" data-path="saving-and-loading-html-content.html">
            
                <a href="saving-and-loading-html-content.html">
            
                    
                    存取 HTML 内容
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">通用</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../general/faq.html">
            
                <a href="../general/faq.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../general/resources.html">
            
                <a href="../general/resources.html">
            
                    
                    相关资源
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Slate Core</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../reference/slate/block.html">
            
                <a href="../reference/slate/block.html">
            
                    
                    Block
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../reference/slate/change.html">
            
                <a href="../reference/slate/change.html">
            
                    
                    Change
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../reference/slate/character.html">
            
                <a href="../reference/slate/character.html">
            
                    
                    Character
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="../reference/slate/data.html">
            
                <a href="../reference/slate/data.html">
            
                    
                    Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="../reference/slate/document.html">
            
                <a href="../reference/slate/document.html">
            
                    
                    Document
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="../reference/slate/inline.html">
            
                <a href="../reference/slate/inline.html">
            
                    
                    Inline
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="../reference/slate/mark.html">
            
                <a href="../reference/slate/mark.html">
            
                    
                    Mark
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8" data-path="../reference/slate/node.html">
            
                <a href="../reference/slate/node.html">
            
                    
                    Node
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9" data-path="../reference/slate/schema.html">
            
                <a href="../reference/slate/schema.html">
            
                    
                    Schema
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10" data-path="../reference/slate/selection.html">
            
                <a href="../reference/slate/selection.html">
            
                    
                    Selection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.11" data-path="../reference/slate/state.html">
            
                <a href="../reference/slate/state.html">
            
                    
                    State
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.12" data-path="../reference/slate/text.html">
            
                <a href="../reference/slate/text.html">
            
                    
                    Text
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.13" data-path="../reference/slate/utils.html">
            
                <a href="../reference/slate/utils.html">
            
                    
                    setKeyGenerator
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.14" data-path="../reference/slate/utils.html">
            
                <a href="../reference/slate/utils.html">
            
                    
                    resetKeyGenerator
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Slate React</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../reference/slate-react/editor.html">
            
                <a href="../reference/slate-react/editor.html">
            
                    
                    Editor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../reference/slate-react/placeholder.html">
            
                <a href="../reference/slate-react/placeholder.html">
            
                    
                    Placeholder
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="../reference/slate-react/custom-nodes.html">
            
                <a href="../reference/slate-react/custom-nodes.html">
            
                    
                    Custom Nodes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="../reference/slate-react/plugins.html">
            
                <a href="../reference/slate-react/plugins.html">
            
                    
                    Plugins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="../reference/slate-react/core-plugin.html">
            
                <a href="../reference/slate-react/core-plugin.html">
            
                    
                    Core Plugin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="../reference/slate-react/utils.html">
            
                <a href="../reference/slate-react/utils.html">
            
                    
                    findDOMNode
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Other Packages</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../reference/slate-html-serializer/">
            
                <a href="../reference/slate-html-serializer/">
            
                    
                    slate-html-serializer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="../reference/slate-hyperscript/">
            
                <a href="../reference/slate-hyperscript/">
            
                    
                    slate-hyperscript
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="../reference/slate-plain-serializer/">
            
                <a href="../reference/slate-plain-serializer/">
            
                    
                    slate-plain-serializer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="../reference/slate-prop-types/">
            
                <a href="../reference/slate-prop-types/">
            
                    
                    slate-prop-types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="../reference/slate-simulator/">
            
                <a href="../reference/slate-simulator/">
            
                    
                    slate-simulator
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >存取 HTML 内容</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p><br></p>
<p></p><p align="center"><strong>Previous:</strong><br><a href="saving-to-a-database.html">Saving to a Database</a></p>
<br><p></p>
<h1 id="saving-and-loading-html-content">Saving and Loading HTML Content</h1>
<p>In the previous guide, we looked at how to serialize the Slate editor&apos;s content and save it for later. What if you want to save the content as HTML? It&apos;s a slightly more involved process, but this guide will show you how to do it.</p>
<p>Let&apos;s start with a basic editor:</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Editor <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;slate&apos;</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>

  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">:</span> Plain<span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token string">&apos;&apos;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">{</span> state <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> state <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Editor
        state<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>state<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onChange<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<p>That will render a basic Slate editor on your page.</p>
<p>Now... we need to add the <a href="../reference/serializers/html.md"><code>Html</code></a> serializer. And to do that, we need to tell it a bit about the schema we plan on using. For this example, we&apos;ll work with a schema that has a few different parts:</p>
<ul>
<li>A <code>paragraph</code> block.</li>
<li>A <code>code</code> block for code samples.</li>
<li>A <code>quote</code> block for quotes...</li>
<li>And <code>bold</code>, <code>italic</code> and <code>underline</code> formatting.</li>
</ul>
<p>By default, the <code>Html</code> serializer, knows nothing about our schema just like Slate itself. To fix this, we need to pass it a set of <code>rules</code>. Each rule defines how to serialize and deserialize a Slate object.</p>
<p>To start, let&apos;s create a new rule with a <code>deserialize</code> function for paragraph blocks.</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">const</span> rules <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment" spellcheck="true">// Add our first rule with a deserializing function.</span>
  <span class="token punctuation">{</span>
    <span class="token function">deserialize</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>tagName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&apos;p&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          kind<span class="token punctuation">:</span> <span class="token string">&apos;block&apos;</span><span class="token punctuation">,</span>
          type<span class="token punctuation">:</span> <span class="token string">&apos;paragraph&apos;</span><span class="token punctuation">,</span>
          nodes<span class="token punctuation">:</span> <span class="token function">next</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>childNodes<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre>
<p>The <code>el</code> argument that the <code>deserialize</code> function receives is just a DOM element. And the <code>next</code> argument is a function that will deserialize any element(s) we pass it, which is how you recurse through each node&apos;s children.</p>
<p>A quick note on <code>el.tagName</code> -- in browser environments, Slate uses the native <code>DOMParser</code> to parse HTML, which returns uppercase tag names. In server-side or node environments, we recommend <a href="https://docs.slatejs.org/reference/serializers/html.html#parsehtml" target="_blank">providing parse5</a> to parse HTML; however, parse5 returns lowercase tag names due to some subtle complexities in specifications. Consequentially, we recommend using case-insensitive tag comparisons, so your code just works everywhere without having to worry about the parser implementation.</p>
<p>Okay, that&apos;s <code>deserialize</code>, now let&apos;s define the <code>serialize</code> property of the paragraph rule as well:</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">const</span> rules <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token function">deserialize</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>tagName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&apos;p&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          kind<span class="token punctuation">:</span> <span class="token string">&apos;block&apos;</span><span class="token punctuation">,</span>
          type<span class="token punctuation">:</span> <span class="token string">&apos;paragraph&apos;</span><span class="token punctuation">,</span>
          nodes<span class="token punctuation">:</span> <span class="token function">next</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>childNodes<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">// Add a serializing function property to our rule...</span>
    <span class="token function">serialize</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>object<span class="token punctuation">.</span>kind <span class="token operator">==</span> <span class="token string">&apos;block&apos;</span> <span class="token operator">&amp;&amp;</span> object<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">&apos;paragraph&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre>
<p>The <code>serialize</code> function should also feel familiar. It&apos;s just taking <a href="../reference/slate">Slate models</a> and turning them into React elements, which will then be rendered to an HTML string.</p>
<p>The <code>object</code> argument of the <code>serialize</code> function will either be a <a href="../reference/slate/node.html"><code>Node</code></a>, a <a href="../reference/slate/mark.html"><code>Mark</code></a> or a special immutable <a href="../reference/serializers/html.md#ruleserialize"><code>String</code></a> object. And the <code>children</code> argument is a React element describing the nested children of the object in question, for recursing.</p>
<p>Okay, so now our serializer can handle <code>paragraph</code> nodes.</p>
<p>Let&apos;s add the other types of blocks we want:</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// Refactor block tags into a dictionary for cleanliness.</span>
<span class="token keyword">const</span> BLOCK_TAGS <span class="token operator">=</span> <span class="token punctuation">{</span>
  p<span class="token punctuation">:</span> <span class="token string">&apos;paragraph&apos;</span><span class="token punctuation">,</span>
  blockquote<span class="token punctuation">:</span> <span class="token string">&apos;quote&apos;</span><span class="token punctuation">,</span>
  pre<span class="token punctuation">:</span> <span class="token string">&apos;code&apos;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> rules <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Switch deserialize to handle more blocks...</span>
    <span class="token function">deserialize</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> type <span class="token operator">=</span> BLOCK_TAGS<span class="token punctuation">[</span>el<span class="token punctuation">.</span>tagName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>type<span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        kind<span class="token punctuation">:</span> <span class="token string">&apos;block&apos;</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> type<span class="token punctuation">,</span>
        nodes<span class="token punctuation">:</span> <span class="token function">next</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>childNodes<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">// Switch serialize to handle more blocks...</span>
    <span class="token function">serialize</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>object<span class="token punctuation">.</span>kind <span class="token operator">!=</span> <span class="token string">&apos;block&apos;</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>object<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">&apos;paragraph&apos;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token keyword">case</span> <span class="token string">&apos;quote&apos;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span>blockquote<span class="token operator">&gt;</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>blockquote<span class="token operator">&gt;</span>
        <span class="token keyword">case</span> <span class="token string">&apos;code&apos;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span>pre<span class="token operator">&gt;</span><span class="token operator">&lt;</span>code<span class="token operator">&gt;</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>code<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>pre<span class="token operator">&gt;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre>
<p>Now each of our block types is handled.</p>
<p>You&apos;ll notice that even though code blocks are nested in a <code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">&gt;</span></span></code> and a <code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span></code> element, we don&apos;t need to specifically handle that case in our <code>deserialize</code> function, because the <code>Html</code> serializer will automatically recurse through <code>el.childNodes</code> if no matching deserializer is found. This way, unknown tags will just be skipped over in the tree, instead of their contents omitted completely.</p>
<p>Okay. So now our serializer can handle blocks, but we need to add our marks to it as well. Let&apos;s do that with a new rule...</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">const</span> BLOCK_TAGS <span class="token operator">=</span> <span class="token punctuation">{</span>
  blockquote<span class="token punctuation">:</span> <span class="token string">&apos;quote&apos;</span><span class="token punctuation">,</span>
  p<span class="token punctuation">:</span> <span class="token string">&apos;paragraph&apos;</span><span class="token punctuation">,</span>
  pre<span class="token punctuation">:</span> <span class="token string">&apos;code&apos;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// Add a dictionary of mark tags.</span>
<span class="token keyword">const</span> MARK_TAGS <span class="token operator">=</span> <span class="token punctuation">{</span>
  em<span class="token punctuation">:</span> <span class="token string">&apos;italic&apos;</span><span class="token punctuation">,</span>
  strong<span class="token punctuation">:</span> <span class="token string">&apos;bold&apos;</span><span class="token punctuation">,</span>
  u<span class="token punctuation">:</span> <span class="token string">&apos;underline&apos;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> rules <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token function">deserialize</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> type <span class="token operator">=</span> BLOCK_TAGS<span class="token punctuation">[</span>el<span class="token punctuation">.</span>tagName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>type<span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        kind<span class="token punctuation">:</span> <span class="token string">&apos;block&apos;</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> type<span class="token punctuation">,</span>
        nodes<span class="token punctuation">:</span> <span class="token function">next</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>childNodes<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">serialize</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>object<span class="token punctuation">.</span>kind <span class="token operator">!=</span> <span class="token string">&apos;block&apos;</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>object<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">&apos;code&apos;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span>pre<span class="token operator">&gt;</span><span class="token operator">&lt;</span>code<span class="token operator">&gt;</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>code<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>pre<span class="token operator">&gt;</span>
        <span class="token keyword">case</span> <span class="token string">&apos;paragraph&apos;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token keyword">case</span> <span class="token string">&apos;quote&apos;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span>blockquote<span class="token operator">&gt;</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>blockquote<span class="token operator">&gt;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// Add a new rule that handles marks...</span>
  <span class="token punctuation">{</span>
    <span class="token function">deserialize</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> type <span class="token operator">=</span> MARK_TAGS<span class="token punctuation">[</span>el<span class="token punctuation">.</span>tagName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>type<span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        kind<span class="token punctuation">:</span> <span class="token string">&apos;mark&apos;</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> type<span class="token punctuation">,</span>
        nodes<span class="token punctuation">:</span> <span class="token function">next</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>childNodes<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">serialize</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>object<span class="token punctuation">.</span>kind <span class="token operator">!=</span> <span class="token string">&apos;mark&apos;</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>object<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">&apos;bold&apos;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span>strong<span class="token operator">&gt;</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>strong<span class="token operator">&gt;</span>
        <span class="token keyword">case</span> <span class="token string">&apos;italic&apos;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span>em<span class="token operator">&gt;</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>em<span class="token operator">&gt;</span>
        <span class="token keyword">case</span> <span class="token string">&apos;underline&apos;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span>u<span class="token operator">&gt;</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>u<span class="token operator">&gt;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre>
<p>Great, that&apos;s all of the rules we need! Now let&apos;s create a new <code>Html</code> serializer and pass in those rules:</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Html <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;slate&apos;</span>

<span class="token comment" spellcheck="true">// Create a new serializer instance with our `rules` from above.</span>
<span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Html</span><span class="token punctuation">(</span><span class="token punctuation">{</span> rules <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>And finally, now that we have our serializer initialized, we can update our app to use it to save and load content, like so:</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// Load the initial state from Local Storage or a default.</span>
<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">(</span>
  localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&apos;content&apos;</span><span class="token punctuation">)</span> <span class="token operator">||</span>
  <span class="token string">&apos;&lt;p&gt;&lt;/p&gt;&apos;</span>
<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>

  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">:</span> html<span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span>initialState<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">// Add a schema with our nodes and marks...</span>
    schema<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      nodes<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        code<span class="token punctuation">:</span> props <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>pre <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">.</span>attributes<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>pre<span class="token operator">&gt;</span><span class="token punctuation">,</span>
        paragraph<span class="token punctuation">:</span> props <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>p <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">.</span>attributes<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token punctuation">,</span>
        quote<span class="token punctuation">:</span> props <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>blockquote <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">.</span>attributes<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>blockquote<span class="token operator">&gt;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      marks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        bold<span class="token punctuation">:</span> props <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>strong<span class="token operator">&gt;</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>strong<span class="token operator">&gt;</span><span class="token punctuation">,</span>
        italic<span class="token punctuation">:</span> props <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>em<span class="token operator">&gt;</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>em<span class="token operator">&gt;</span><span class="token punctuation">,</span>
        underline<span class="token punctuation">:</span> props <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>u<span class="token operator">&gt;</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>u<span class="token operator">&gt;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  onChange <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> state <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// When the document changes, save the serialized HTML to Local Storage.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>document <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>state<span class="token punctuation">.</span>document<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> string <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
      localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&apos;content&apos;</span><span class="token punctuation">,</span> string<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> state <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Editor
        schema<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>schema<span class="token punctuation">}</span>
        state<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>state<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onChange<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<p>And that&apos;s it! When you make any changes in your editor, you should see the updated HTML being saved to Local Storage. And when you refresh the page, those changes should be carried over.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="saving-to-a-database.html" class="navigation navigation-prev " aria-label="Previous page: 保存到数据库">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../general/faq.html" class="navigation navigation-next " aria-label="Next page: FAQ">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"存取 HTML 内容","level":"2.7","depth":1,"next":{"title":"FAQ","level":"3.1","depth":1,"path":"general/faq.md","ref":"./general/faq.md","articles":[]},"previous":{"title":"保存到数据库","level":"2.6","depth":1,"path":"walkthroughs/saving-to-a-database.md","ref":"./walkthroughs/saving-to-a-database.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-highlight","prism","github"],"root":"./docs-cn","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"github":{"url":"https://github.com/ianstormtaylor/slate"},"prism":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"Introduction.md","glossary":"GLOSSARY.md","summary":"Readme.md"},"variables":{},"gitbook":"3.2.2"},"file":{"path":"walkthroughs/saving-and-loading-html-content.md","mtime":"2017-09-14T06:18:50.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-09-24T03:09:53.286Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

